{{- define "main" -}}
  <section class="container my-5">
    <header class="mb-4">
      <h1>{{ .Title }} Social Proofs</h1>
      <p>Testimonials from clients who engaged me to address delivery constraints, transform systems of work, implement tooling, or attend training courses. Also includes colleagues who worked alongside me on projects.</p>
      <p>These statements describe what people observed or experienced. They are evidence of approach, knowledge, and working style, not endorsement.</p>
    </header>

    <div class="mb-5">
      <h2>How to Use This</h2>
      <p>Look for testimonials that describe constraints similar to yours. Notice what the client valued, what changed, and whether the outcome matched their intent.</p>
      <p>Filter by category if you want to see feedback specific to a particular engagement type or outcome area.</p>
    </div>

    {{- $currentCategory := .Title | lower -}}
    {{- $allQuotes := .Site.Data.socialproof.quotes -}}


    <nav class="d-flex justify-content-start gap-2 mb-4 flex-wrap">
      <a href="/social-proof/" class="btn btn-sm btn-outline-primary">All ({{ len $allQuotes }})</a>
      {{- range $name, $taxonomy := .Site.Taxonomies.socialProofCategories -}}
        <a href="{{ $taxonomy.Page.Permalink }}" class="btn btn-sm {{ if eq $currentCategory $name }}btn-primary{{ else }}btn-outline-primary{{ end }}">{{ $taxonomy.Page.Title }} ({{ len (where $allQuotes "category" $name) }})</a>
      {{- end -}}
    </nav>

    {{- $pages := .Pages.ByWeight -}}

    {{- $paginator := .Paginate $pages 5 -}}


    <div class="text-muted mb-4" style="font-size: 0.9rem;">
      <p>Showing {{ len $paginator.Pages }} of {{ $paginator.TotalNumberOfElements }} social proofs</p>
    </div>

    <div>
      {{- range $paginator.Pages -}}
        <div class="mb-4 pb-4 border-bottom">
          <blockquote class="mb-3">
            <p>{{ .Params.text }}</p>
          </blockquote>
          <footer>
            <cite class="text-body not-italic">
              <strong>{{ .Params.name }}</strong>
              {{- with .Params.title }}{{ if ne . "" }}<br /><span class="text-muted" style="font-size: 0.9rem;">{{ . }}</span>{{ end }}{{ end -}}
            </cite>
            <div class="d-flex flex-wrap gap-2 align-items-center mt-2" style="font-size: 0.9rem;">
              {{- with .Params.relationship }}<span class="badge bg-primary-subtle text-primary">{{ . }}</span>{{ end -}}
              {{- with .Params.class }}<span class="badge bg-warning-subtle text-warning">{{ . | upper }}</span>{{ end -}}
              {{- with .Params.stars }}<span class="text-warning">{{ range seq . }}⭐{{ end }}</span>{{ end -}}
              {{- with .Date }}<time datetime="{{ .Format "2006-01-02" }}" class="text-muted">{{ .Format "2 Jan 2006" }}</time>{{ end -}}
            </div>
          </footer>
        </div>
      {{- end -}}
    </div>

    {{- if gt $paginator.TotalPages 1 -}}
      <nav class="d-flex justify-content-center gap-2 mt-5 flex-wrap" aria-label="Social proof pagination">
        {{- if $paginator.HasPrev -}}
          <a href="{{ $paginator.Prev.URL }}" class="btn btn-sm btn-outline-primary">← Previous</a>
        {{- end -}}

        {{- $currentPage := $paginator.PageNumber -}}
        {{- $totalPages := $paginator.TotalPages -}}

        {{- if gt $currentPage 2 -}}
          <a href="{{ $paginator.First.URL }}" class="btn btn-sm btn-outline-primary">1</a>
          {{- if gt $currentPage 3 -}}
            <span class="btn btn-sm btn-outline-secondary disabled">...</span>
          {{- end -}}
        {{- end -}}

        {{- range $paginator.Pagers -}}
          {{- $distance := sub $currentPage .PageNumber -}}
          {{- if le (math.Abs $distance) 1 -}}
            {{- if eq .PageNumber $currentPage -}}
              <span class="btn btn-sm btn-primary">{{ .PageNumber }}</span>
            {{- else -}}
              <a href="{{ .URL }}" class="btn btn-sm btn-outline-primary">{{ .PageNumber }}</a>
            {{- end -}}
          {{- end -}}
        {{- end -}}

        {{- if lt $currentPage (sub $totalPages 1) -}}
          {{- if lt $currentPage (sub $totalPages 2) -}}
            <span class="btn btn-sm btn-outline-secondary disabled">...</span>
          {{- end -}}
          <a href="{{ $paginator.Last.URL }}" class="btn btn-sm btn-outline-primary">{{ $totalPages }}</a>
        {{- end -}}

        {{- if $paginator.HasNext -}}
          <a href="{{ $paginator.Next.URL }}" class="btn btn-sm btn-outline-primary">Next →</a>
        {{- end -}}
      </nav>
    {{- end -}}


    <div class="mt-5 pt-4 border-top">
      <h2>What to Do Next</h2>
      <p>Testimonials show what others experienced. The relevant question is whether your constraint is addressable using a similar diagnostic process.</p>
      <ul>
        <li>Review <a href="/problems/">problems I solve</a> to see if your constraint fits a known pattern</li>
        <li>Read <a href="/case-studies/">case studies</a> to see detailed evidence of diagnostic work and outcomes</li>
        <li>Explore <a href="/insights/">insights</a> to understand the reasoning behind my approach</li>
      </ul>
      <p>If your situation appears similar, <a href="/diagnostic-assessment/">start a diagnostic conversation</a>.</p>
    </div>
  </section>
{{- end -}}
