{{- /* Enhanced Article Schema with Reading Time, Word Count, Publisher, and Image Metadata */ -}}
{{- if .IsPage -}}
{{- $readingInfo := partial "functions/get-reading-time.html" . -}}
{{- $image := partial "functions/get-image.html" . -}}
{{- $imageResource := "" -}}
{{- $imageWidth := 1200 -}}
{{- $imageHeight := 630 -}}

{{- /* Try to get image dimensions from resource */ -}}
{{- if not (strings.Contains $image.src "#missing#") -}}
  {{- if strings.HasPrefix $image.src "/" -}}
    {{- $imagePath := strings.TrimPrefix "/" $image.src -}}
    {{- $imageResource = resources.Get $imagePath -}}
    {{- if $imageResource -}}
      {{- $imageWidth = $imageResource.Width -}}
      {{- $imageHeight = $imageResource.Height -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": {{ .Title }},
  "description": {{ with .Description }}{{ . }}{{ else }}{{ .Summary }}{{ end }},
  "image": {
    "@type": "ImageObject",
    "url": {{ $image.src | absURL }},
    "width": {{ $imageWidth }},
    "height": {{ $imageHeight }}
  },
  "datePublished": {{ .PublishDate.Format "2006-01-02T15:04:05Z07:00" }},
  "dateModified": {{ with .Lastmod }}{{ .Format "2006-01-02T15:04:05Z07:00" }}{{ else }}{{ .PublishDate.Format "2006-01-02T15:04:05Z07:00" }}{{ end }},
  "author": {
    "@type": "Person",
    "@id": {{ printf "%s#person" site.BaseURL }},
    "name": {{ site.Params.author }},
    "url": {{ site.BaseURL }}
  },
  "publisher": {
    "@type": "Organization",
    "name": {{ site.Title }},
    "logo": {
      "@type": "ImageObject",
      "url": {{ site.Params.og_image | absURL }},
      "width": 400,
      "height": 400
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": {{ .Permalink }}
  },
  "wordCount": {{ $readingInfo.wordCount }},
  "timeRequired": {{ printf "PT%dM" $readingInfo.minutes }},
  {{- with .Params.tags -}}
  "keywords": {{ delimit . ", " }},
  {{- end -}}
  "articleSection": {{ .Section }},
  "inLanguage": "en-GB",
  "isAccessibleForFree": true,
  "url": {{ .Permalink }}
}
</script>
{{- end -}}
