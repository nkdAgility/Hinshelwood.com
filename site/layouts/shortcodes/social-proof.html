{{- $id := .Get "id" -}}
{{- $truncate := .Get "truncate" | default 0 -}}
{{- if $truncate -}}
  {{- $truncate = int $truncate -}}
{{- end -}}

{{- $page := "" -}}
{{- $socialProofPages := where .Site.RegularPages "Section" "social-proof" -}}

{{- if $id -}}
  {{- $page = index (where $socialProofPages "Params.ItemId" $id) 0 -}}
{{- end -}}

{{- with $page -}}
  {{ partial "components/social-proof.html" (dict "page" . "truncate" $truncate "showBadges" true) }}
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.quote-toggle').forEach(function(btn) {
      let expanded = false;
      const fullText = btn.getAttribute('data-full-text');
      const shortText = btn.getAttribute('data-short-text');
      const textSpan = btn.previousElementSibling;
      
      btn.addEventListener('click', function() {
        expanded = !expanded;
        if (expanded) {
          textSpan.textContent = fullText;
          btn.textContent = 'less';
        } else {
          textSpan.textContent = shortText + '...';
          btn.textContent = 'more...';
        }
      });
    });
  });
  </script>
{{- else -}}
  <p><em>Social proof not found</em></p>
{{- end -}}
